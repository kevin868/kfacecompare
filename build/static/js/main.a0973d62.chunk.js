(this.webpackJsonpkfacecompare=this.webpackJsonpkfacecompare||[]).push([[0],{32:function(e,t,n){},33:function(e,t,n){},34:function(e,t,n){},53:function(e,t,n){},56:function(e,t,n){"use strict";n.r(t);var s=n(0),i=n(3),a=n.n(i),r=n(5),l=n.n(r),o=(n(32),n(14)),c=n(23),u=n(8),d=n(9),h=n(10),p=n(12),f=n(11),m=(n(33),n(34),n(24)),j=n.n(m),b=n(26),g=n(4),v=(n(53),n(25)),x=n.p+"static/media/UploadIcon.469126df.svg",O={display:"flex",alignItems:"center",justifyContent:"center",flexWrap:"wrap",width:"100%"},y="NOT_SUPPORTED_EXTENSION",F="FILESIZE_TOO_LARGE",I=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).state={pictures:Object(b.a)(e.defaultImages),files:[],fileErrors:[]},s.inputElement="",s.onDropFile=s.onDropFile.bind(Object(g.a)(s)),s.onUploadClick=s.onUploadClick.bind(Object(g.a)(s)),s.triggerFileUpload=s.triggerFileUpload.bind(Object(g.a)(s)),s}return Object(h.a)(n,[{key:"componentDidUpdate",value:function(e,t,n){t.files!==this.state.files&&this.props.onChange(this.state.files,this.state.pictures)}},{key:"componentWillReceiveProps",value:function(e){e.defaultImages!==this.props.defaultImages&&this.setState({pictures:e.defaultImages})}},{key:"hasExtension",value:function(e){var t="("+this.props.imgExtension.join("|").replace(/\./g,"\\.")+")$";return new RegExp(t,"i").test(e)}},{key:"onDropFile",value:function(e){for(var t=this,n=e.target.files,s=[],i=[],a=0;a<n.length;a++){var r=n[a],l={name:r.name};this.hasExtension(r.name)?r.size>this.props.maxFileSize?(l=Object.assign(l,{type:F}),i.push(l)):s.push(this.readFile(r)):(l=Object.assign(l,{type:y}),i.push(l))}this.setState({fileErrors:i});var o=this.props.singleImage;Promise.all(s).then((function(e){var n=o?[]:t.state.pictures.slice(),s=o?[]:t.state.files.slice();e.forEach((function(e){n.push(e.dataURL),s.push(e.file)})),t.setState({pictures:n,files:s})}))}},{key:"onUploadClick",value:function(e){e.target.value=null}},{key:"readFile",value:function(e){return new Promise((function(t,n){var s=new FileReader;s.onload=function(n){var s=n.target.result;s=s.replace(";base64",";name=".concat(e.name,";base64")),t({file:e,dataURL:s})},s.readAsDataURL(e)}))}},{key:"removeImage",value:function(e){var t=this,n=this.state.pictures.findIndex((function(t){return t===e})),s=this.state.pictures.filter((function(e,t){return t!==n})),i=this.state.files.filter((function(e,t){return t!==n}));this.setState({pictures:s,files:i},(function(){t.props.onChange(t.state.files,t.state.pictures)}))}},{key:"renderErrors",value:function(){var e=this;return this.state.fileErrors.map((function(t,n){return Object(s.jsxs)("div",{className:"errorMessage "+e.props.errorClass,style:e.props.errorStyle,children:["* ",t.name," ",t.type===F?e.props.fileSizeError:e.props.fileTypeError]},n)}))}},{key:"renderIcon",value:function(){if(this.props.withIcon)return Object(s.jsx)("img",{src:x,className:"uploadIcon",alt:"Upload Icon"})}},{key:"renderLabel",value:function(){if(this.props.withLabel)return Object(s.jsx)("p",{className:this.props.labelClass,style:this.props.labelStyles,children:this.props.label})}},{key:"renderPreview",value:function(){return Object(s.jsx)("div",{className:"uploadPicturesWrapper",children:Object(s.jsx)(v.a,{enterAnimation:"fade",leaveAnimation:"fade",style:O,children:this.renderPreviewPictures()})})}},{key:"renderPreviewPictures",value:function(){var e=this;return this.state.pictures.map((function(t,n){return Object(s.jsxs)("div",{className:"uploadPictureContainer",children:[Object(s.jsx)("div",{className:"deleteImage",onClick:function(){return e.removeImage(t)},children:"X"}),Object(s.jsx)("img",{src:t,className:"uploadPicture",alt:"preview"})]},n)}))}},{key:"triggerFileUpload",value:function(){this.inputElement.click()}},{key:"clearPictures",value:function(){this.setState({pictures:[]})}},{key:"render",value:function(){var e=this;return Object(s.jsx)("div",{className:"fileUploader "+this.props.className,style:this.props.style,children:Object(s.jsxs)("div",{className:"fileContainer",style:this.props.fileContainerStyle,children:[this.renderIcon(),this.renderLabel(),Object(s.jsx)("div",{className:"errorsContainer",children:this.renderErrors()}),Object(s.jsx)("button",{type:this.props.buttonType,className:"chooseFileButton "+this.props.buttonClassName,style:this.props.buttonStyles,onClick:this.triggerFileUpload,children:this.props.buttonText}),Object(s.jsx)("input",{type:"file",ref:function(t){return e.inputElement=t},name:this.props.name,multiple:!this.props.singleImage,onChange:this.onDropFile,onClick:this.onUploadClick,accept:this.props.accept}),this.props.withPreview?this.renderPreview():null]})})}}]),n}(a.a.Component);I.defaultProps={className:"",fileContainerStyle:{},buttonClassName:"",buttonStyles:{},withPreview:!1,accept:"image/*",name:"",withIcon:!0,buttonText:"Choose images",buttonType:"button",withLabel:!0,label:"Max file size: 5mb, accepted: jpg|gif|png",labelStyles:{},labelClass:"",imgExtension:[".jpg",".jpeg",".gif",".png"],maxFileSize:5242880,fileSizeError:" file size is too big",fileTypeError:" is not a supported file extension",errorClass:"",style:{},errorStyle:{},singleImage:!1,onChange:function(){},defaultImages:[]};var C=I;var E=function(){return Object(s.jsxs)("div",{children:[Object(s.jsx)("h1",{children:"FaceCompare"}),Object(s.jsx)("div",{className:"intro",children:Object(s.jsxs)("div",{children:["Select 2 or 3 pictures of people to calculate how similar they are.",Object(s.jsx)("br",{}),Object(s.jsx)("br",{}),"This tool uses dlib for face detection, and"," ",Object(s.jsx)("a",{href:"http://cmusatyalab.github.io/openface/",children:"OpenFace"})," pre-trained neural net models to compute a 128-dimensional face representation.",Object(s.jsx)("br",{}),Object(s.jsx)("br",{}),"Privacy Note: Our server does not store any of the photos you submit."]})})]})},N=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).setIsLoading=function(e){var t={isLoading:e};!0===e&&(t.error=void 0),s.setState(t)},s.setError=function(e){s.setState({error:e||"Backend is down. It's Kevin's fault! Try again in 12 hours."})},s.sendGoogleEvent=function(e){window.gtag("event","submit",{num_photos:e})},s.sendGoogleErrorEvent=function(e){window.gtag("event","backend_error",{num_photos:e})},s.fileChangedHandler=function(e){return function(t){console.log(e);var n="file".concat(e);s.setState(Object(u.a)({},n,t[0]));var i=t[0]&&t[0].name,a=i&&i.length>32?k(e):i;if(a){var r=s.state.fileToAliasMap||{};r[i]=a,s.setState({fileToAliasMap:r})}}},s.onUpdateName=function(e){return function(t){var n=Object(c.a)({},s.state.fileToAliasMap);n[s.getFilename(e)]=t.target.value,s.setState({fileToAliasMap:n})}},s.uploadHandler=function(){console.log(s.state);var e=new FormData,t=0;if(s.state.file1?(e.append("imgs[]",s.state.file1,s.state.file1.name),t+=1):console.log("Must select Image A"),s.state.file2?(e.append("imgs[]",s.state.file2,s.state.file2.name),t+=1):console.log("Must select Image B"),s.state.file3?(e.append("imgs[]",s.state.file3,s.state.file3.name),t+=1):console.log("Missing Image C, Proceeding"),console.log(e.getAll("imgs[]")),e.getAll("imgs[]").length<2)return s.setError("Please select at least 2 images to compare."),void s.scrollToBottom();s.setIsLoading(!0),s.sendGoogleEvent(t);j.a.post("http://35.194.36.121:8089/post_imgs",e).then(s.onBackendResponse).catch((function(e){s.onBackendError(e,t)}))},s.onBackendResponse=function(e){console.log(e),s.setIsLoading(!1);var t=e.data.resultsArray;s.setState({results:t}),console.log(s.state),s.scrollToBottom()},s.onBackendError=function(e,t){s.setIsLoading(!1),s.setError(e.response&&e.response.data.error),s.sendGoogleErrorEvent(t),s.scrollToBottom()},s.getFilename=function(e){var t="file".concat(e);return s.state[t]?s.state[t].name:null},s.getAliasFromFileIndex=function(e){return s.state.fileToAliasMap[s.getFilename(e)]},s.scrollToBottom=function(){s.bottom.scrollIntoView({behavior:"smooth"})},s.state={isLoading:!1,fileToAliasMap:{}},s}return Object(h.a)(n,[{key:"render",value:function(){var e,t=this,n=this.state.error?Object(s.jsxs)("div",{className:"errorMsg",children:[Object(s.jsxs)("h5",{children:["Error: ",this.state.error," "]}),(e=this.state.error,e&&e.startsWith("Unable to find a face")?Object(s.jsx)("h4",{className:"errorHint",children:"Hint: try a different photo and crop around the face."}):null)]}):null,i=function(e){return t.state.fileToAliasMap[e]||e};return Object(s.jsxs)("div",{children:[Object(s.jsxs)("div",{className:"row",children:[Object(s.jsx)(w,{num:1,fileChangedHandler:this.fileChangedHandler,getFilename:this.getFilename,getAliasFromFileIndex:this.getAliasFromFileIndex,onUpdateName:this.onUpdateName(1)}),Object(s.jsx)(w,{num:2,fileChangedHandler:this.fileChangedHandler,getFilename:this.getFilename,getAliasFromFileIndex:this.getAliasFromFileIndex,onUpdateName:this.onUpdateName(2)}),Object(s.jsx)(w,{num:3,fileChangedHandler:this.fileChangedHandler,getFilename:this.getFilename,getAliasFromFileIndex:this.getAliasFromFileIndex,onUpdateName:this.onUpdateName(3)})]}),Object(s.jsx)("button",{className:"uploadFilesButton",onClick:this.uploadHandler,children:this.state.isLoading?"Loading ...":"Submit"}),n,Object(s.jsx)(T,{results:this.state.results,getAliasFromKey:i}),this.state.results?Object(s.jsx)("div",{className:"filename",children:"Raw Distances between Image Representations (Smaller is more similar)"}):null,Object(s.jsx)(S,{results:this.state.results,getAliasFromKey:i}),this.state.results?Object(s.jsx)("div",{className:"filename errorHint hintPadded",children:"Hint: Edit the person's name in the box (optional). This makes the tables easier to read!"}):null,Object(s.jsx)("div",{style:{float:"left",clear:"both"},ref:function(e){t.bottom=e}})]})}}]),n}(i.Component),k=function(e){return String.fromCharCode(64+e)},w=function(e){var t=e.num,n=e.fileChangedHandler,i=e.getFilename,a=e.getAliasFromFileIndex,r=e.onUpdateName;return Object(s.jsxs)("div",{className:"column",children:[Object(s.jsx)(C,{withIcon:!1,buttonText:"Choose Image ".concat(k(t)),onChange:n(t),withPreview:!0,imgExtension:[".jpg",".gif",".png",".jpeg"],maxFileSize:5242880,singleImage:!0}),Object(s.jsxs)("div",{className:"filename",children:[i(t)===a(t)?null:i(t),Object(s.jsx)("div",{children:Object(s.jsx)("input",{className:"fileRename",title:"(Optional) Type person's name",defaultValue:a(t),type:"text",onChange:r})})]})]})},S=function(e){var t=e.results,n=e.getAliasFromKey;return t?Object(s.jsx)("div",{children:Object(s.jsx)("table",{className:"summaryTable",children:Object(s.jsxs)("tbody",{children:[Object(s.jsxs)("tr",{children:[Object(s.jsx)("th",{children:"Face 1"}),Object(s.jsx)("th",{children:"Face 2"}),Object(s.jsx)("th",{children:"Distance"})]}),t.map((function(e){var t=Object(o.a)(e,3),i=t[0],a=t[1],r=t[2];return Object(s.jsxs)("tr",{children:[Object(s.jsx)("td",{children:n(i)}),Object(s.jsx)("td",{children:n(a)}),Object(s.jsx)("td",{children:r})]})}))]})})}):null},T=function(e){var t=e.results,n=e.getAliasFromKey,i=function(e){return 1/(1+Math.pow(Math.E,2*(e-1.6)))},a=function(e){return e<=.15?1:e>.4?i(e):function(e){return(1*(.4-e)+i(e)*(e-.15))/.25}(e)},r=function(e){return Math.round(100*a(e)*10)/10};return t?Object(s.jsx)("div",{children:Object(s.jsx)("table",{className:"summaryTable",children:Object(s.jsxs)("tbody",{children:[Object(s.jsxs)("tr",{children:[Object(s.jsx)("th",{children:"Face 1"}),Object(s.jsx)("th",{children:"Face 2"}),Object(s.jsx)("th",{children:"Similarity"})]}),t.map((function(e){var t=Object(o.a)(e,3),a=t[0],l=t[1],c=t[2];return Object(s.jsxs)("tr",{children:[Object(s.jsx)("td",{children:n(a)}),Object(s.jsx)("td",{children:n(l)}),Object(s.jsx)("td",{children:i(c)>.6?Object(s.jsxs)("b",{children:[r(c),"%"]}):"".concat(r(c),"%")})]})}))]})})}):null},A=function(){return Object(s.jsxs)("div",{children:[Object(s.jsx)(E,{}),Object(s.jsx)(N,{})]})},P=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,57)).then((function(t){var n=t.getCLS,s=t.getFID,i=t.getFCP,a=t.getLCP,r=t.getTTFB;n(e),s(e),i(e),a(e),r(e)}))};l.a.render(Object(s.jsx)(a.a.StrictMode,{children:Object(s.jsx)(A,{})}),document.getElementById("root")),P()}},[[56,1,2]]]);
//# sourceMappingURL=main.a0973d62.chunk.js.map